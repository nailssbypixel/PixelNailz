<script>
// Initialize booking datepicker with greyed-out booked dates
let bookingPicker;
async function initBookingDatepicker() {
  try {
    const response = await fetch(WEB_APP_URL + "?action=fetch");
    const data = await response.json();
    const bookedDates = (data.bookings || []).map(b => b.date);

    if(bookingPicker) bookingPicker.destroy();

    bookingPicker = flatpickr("#date", {
      dateFormat: "Y-m-d",
      minDate: "today",
      disableMobile: true,
      // show all allowed dates, but disable booked ones
      enable: allowedDates.map(d => {
        return bookedDates.includes(d) ? { from: d, to: d, disabled: true, className: "booked-date" } : d;
      })
    });
  } catch(e) {
    console.error(e);
  }
}
initBookingDatepicker();
</script>

<style>
/* Grey out already booked dates */
.booked-date {
  background: #ddd !important;
  color: #999 !important;
  text-decoration: line-through;
  cursor: not-allowed;
}
</style>
